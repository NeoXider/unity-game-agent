# UI Builder (UI Toolkit) — рекомендации

UI Builder — визуальный редактор UXML/USS для UI Toolkit. По скиллу **дизайн UI приоритетно делается через UI Builder**, если версия Unity поддерживает и пользователь не попросил иначе (например, uGUI/Canvas).

**Документация Unity (актуальная):**
- [UI Toolkit](https://docs.unity3d.com/Manual/UIElements.html) — основной раздел (введение, UXML, USS, события, runtime, примеры).
- [UI Builder](https://docs.unity3d.com/Manual/UIBuilder.html) — визуальный редактор UXML/USS.
- [Get started with UI Toolkit](https://docs.unity3d.com/Manual/UIE-simple-ui-toolkit-workflow.html) — быстрый старт.

---

## Когда использовать

- **Приоритет:** Unity поддерживает UI Builder (2021.1+ встроен, 2020.x/2019.4 — пакет `com.unity.ui.builder`) и пользователь **не указал** uGUI/Canvas/другое — делать UI **всегда** через UI Builder (UXML, USS, UI Toolkit runtime).
- **Исключение:** пользователь явно попросил uGUI, Canvas, другой подход — следовать запросу.
- **Проверка поддержки:** Window → UI Toolkit → UI Builder (или Package Manager → UI Builder). Если окно открывается — использовать.

---

## Рекомендации

- **Структура:** один UXML на экран/панель (MainMenu.uxml, GameHUD.uxml, SettingsPanel.uxml). Общие стили — в общем USS (например `common.uss`), экранные — в своих USS или в том же файле что и UXML.
- **Имена:** осмысленные имена элементам в UI Builder (не только `VisualElement`). Использовать name или class для выборки из кода (`root.Q<Button>("play-button")`).
- **Данные и тексты:** тексты, размеры, цвета по возможности из ScriptableObject (UiData и т.д.) — не хардкодить в UXML/USS то, что может меняться по настройкам.
- **Рантайм:** документ UXML подключать к UIDocument; логику (кнопки, подписки) — в отдельном C# (MonoBehaviour или presenter), не размазывать по сцене.
- **Верстка:** Flex (по умолчанию), при необходимости Absolute. Избегать жёстких пикселей где нужна адаптивность; использовать % или flex-grow.
- **Референсы:** см. ссылки на документацию в начале файла.

---

## Паттерны

- **Один документ — один экран/панель:** не смешивать все экраны в одном UXML; разбивать по панелям и показывать/скрывать через `display` или переключение активного UIDocument.
- **Классы для вариантов:** общие стили через классы (.button-primary, .panel-modal), переиспользовать в разных экранах.
- **Q() и UQueryBuilder:** получать элементы по имени или классу; кэшировать ссылки при инициализации, не искать каждый кадр.
- **События:** подписываться на click/focus в C#, не вешать логику в UXML (кроме простых переходов через custom data, если так оговорено).

---

## Анти-паттерны

- **Не делать UI на Canvas/uGUI по умолчанию** — если скилл говорит «приоритетно UI Builder» и пользователь не попросил иначе.
- **Не дублировать одни и те же стили** в каждом USS — выносить в общий USS.
- **Не хардкодить длинные тексты** в UXML — брать из SO или локализации.
- **Не искать элементы по индексу** в иерархии (например, третий VisualElement) — давать имена/классы и искать по ним.
- **Не смешивать UI Toolkit и uGUI** в одном экране без явной необходимости (разный рендеринг, порядок отрисовки).

---

## Версии Unity

| Версия | UI Builder |
|--------|------------|
| 2021.1+ | Встроен (Window → UI Toolkit → UI Builder) |
| 2020.x | Пакет в Package Manager (включить preview при необходимости) |
| 2019.4 | Пакет preview `com.unity.ui.builder` |

Если проект на более старой версии или пакет недоступен — использовать uGUI/Canvas и зафиксировать в DEV_STATE/AGENT_MEMORY причину (версия не поддерживает UI Builder).

---

## Связь с другими инструментами

- **Figma:** если в настройках включен Figma — макеты могут приходить из Figma; реализация в проекте всё равно приоритетно через UI Builder (UXML/USS), если пользователь не попросил иначе.
- **MCP:** создание/правка UXML и USS через файлы (IDE); сцена, UIDocument, префабы — через Unity MCP при необходимости.
- **ScriptableObject:** тексты, цвета, размеры UI — из SO (UiData и т.д.), см. [code-writing.md](code-writing.md).
