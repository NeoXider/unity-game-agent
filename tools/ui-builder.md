# UI Builder (UI Toolkit) — рекомендации

UI Builder — визуальный редактор UXML/USS для UI Toolkit. По скиллу **весь интерфейс делается только через UI Builder** (Canvas/uGUI не используются).

**Документация Unity (актуальная):**
- [UI Toolkit](https://docs.unity3d.com/Manual/UIElements.html) — основной раздел (введение, UXML, USS, события, runtime, примеры).
- [UI Builder](https://docs.unity3d.com/Manual/UIBuilder.html) — визуальный редактор UXML/USS.
- [Get started with UI Toolkit](https://docs.unity3d.com/Manual/UIE-simple-ui-toolkit-workflow.html) — быстрый старт.

---

## Когда использовать

- **Всегда:** UI делается **только** через UI Builder (UXML, USS, UIDocument). Canvas/uGUI не использовать.
- **Проверка поддержки:** Unity 2021.1+ — UI Builder встроен; 2020.x/2019.4 — пакет `com.unity.ui.builder`. Window → UI Toolkit → UI Builder. Если окно открывается — использовать.

---

## Правила структуры

- **Каждая страница/экран — отдельный UXML.** Один UXML на один экран или панель (MainMenu.uxml, GameHUD.uxml, SettingsPanel.uxml, ShopScreen.uxml и т.д.). Не объединять несколько экранов в одном UXML.
- **Для каждого UXML — свой USS.** Всегда создавать USS-файл под каждый UXML (MainMenu.uxml → MainMenu.uss, GameHUD.uxml → GameHUD.uss). Общие стили выносить в общий USS (например `common.uss`), экранные/компонентные — в свой USS.
- **Повторяющиеся элементы — отдельный UXML + USS.** Любой переиспользуемый элемент интерфейса делать своим UXML и USS: кнопка с текстом, кнопка с иконкой, элемент магазина (карточка товара), элемент улучшения, строка списка, элемент инвентаря и т.д. Подключать как Template в родительский UXML или клонировать из кода. Так сохраняется единый вид и правки в одном месте.

---

## Рекомендации

- **Структура (итого):** страница = один UXML + один USS; повторяющийся элемент = свой UXML + свой USS; общие стили — в common.uss.
- **Имена:** осмысленные имена элементам в UI Builder (не только `VisualElement`). Использовать name или class для выборки из кода (`root.Q<Button>("play-button")`).
- **Данные и тексты:** тексты, размеры, цвета по возможности из ScriptableObject (UiData и т.д.) — не хардкодить в UXML/USS то, что может меняться по настройкам.
- **Рантайм:** документ UXML подключать к UIDocument; логику (кнопки, подписки) — в отдельном C# (MonoBehaviour или presenter), не размазывать по сцене.
- **Верстка:** Flex (по умолчанию), при необходимости Absolute. Избегать жёстких пикселей где нужна адаптивность; использовать % или flex-grow.
- **Референсы:** см. ссылки на документацию в начале файла.

---

## Паттерны

- **Один UXML — один экран/панель:** не смешивать все экраны в одном UXML; разбивать по панелям и показывать/скрывать через `display` или переключение активного UIDocument.
- **Повторяющиеся блоки как UXML-шаблоны:** кнопка с текстом (ButtonWithText.uxml + .uss), кнопка с иконкой (ButtonWithIcon.uxml + .uss), элемент магазина (ShopItem.uxml + .uss), элемент улучшения (UpgradeItem.uxml + .uss) — каждый со своим USS. Вставлять в экран через Template или клонирование из C#.
- **Классы для вариантов:** общие стили через классы (.button-primary, .panel-modal), переиспользовать в разных экранах и компонентах.
- **Q() и UQueryBuilder:** получать элементы по имени или классу; кэшировать ссылки при инициализации, не искать каждый кадр.
- **События:** подписываться на click/focus в C#, не вешать логику в UXML (кроме простых переходов через custom data, если так оговорено).

---

## Анти-паттерны

- **Не использовать Canvas/uGUI** — весь UI только через UI Builder (UIDocument + UXML/USS).
- **Не делать несколько экранов в одном UXML** — каждая страница отдельный UXML.
- **Не оставлять UXML без USS** — для каждого UXML создавать свой USS.
- **Не дублировать разметку повторяющихся элементов** — кнопки с текстом/иконкой, элементы магазина, улучшений и т.д. делать отдельными UXML+USS и переиспользовать.
- **Не дублировать одни и те же стили** в каждом USS — выносить в общий USS.
- **Не хардкодить длинные тексты** в UXML — брать из SO или локализации.
- **Не искать элементы по индексу** в иерархии (например, третий VisualElement) — давать имена/классы и искать по ним.

---

## Версии Unity

| Версия | UI Builder |
|--------|------------|
| 2021.1+ | Встроен (Window → UI Toolkit → UI Builder) |
| 2020.x | Пакет в Package Manager (включить preview при необходимости) |
| 2019.4 | Пакет preview `com.unity.ui.builder` |

Если версия Unity не поддерживает UI Builder — зафиксировать в DEV_STATE/AGENT_MEMORY причину.

---

## Связь с другими инструментами

- **Figma:** если в настройках включен Figma — макеты могут приходить из Figma; реализация в проекте всё равно приоритетно через UI Builder (UXML/USS), если пользователь не попросил иначе.
- **MCP:** создание/правка UXML и USS через файлы (IDE); сцена, UIDocument, префабы — через Unity MCP при необходимости.
- **ScriptableObject:** тексты, цвета, размеры UI — из SO (UiData и т.д.), см. [code-writing.md](code-writing.md).
