---
name: unity-game-agent
description: Unity Game Agent — создание Unity-игр агентом по этапам (набросок → план → реализация → проверка). Use when the user asks to build or prototype a Unity game, implement game features step-by-step, or use Unity MCP / other MCPs for scene and editor automation.
---

# Unity Game Agent

Сборка Unity-игры по циклу: **набросок → этапы → реализация → проверка → отчёт**, с использованием MCP (Unity MCP и др.) где доступно.

Этот файл намеренно **короткий** (экономим токены). Детали и шаблоны лежат в:
- **Шаблоны файлов проекта + справка:** [reference.md](reference.md)
- **Выбор режима:** [MODE_CHOICE.md](MODE_CHOICE.md), подробности: [MODE_DETAILS.md](MODE_DETAILS.md), правила: `modes/*.md`
- **Инструменты/код/Unity:** `tools/*.md`
- **Готовые запросы:** [PROMPTS.md](PROMPTS.md)

## Цель проекта AutoUnity

**Цель текущего проекта:** сделать **набор MCP, готовые промпты/скиллы, автоматизацию (bat) и ComfyUI** для **создания автономных Unity-игр с помощью ИИ**.

Ключевое правило использования инструментов:
- **Файлы/папки/код**: не использовать Unity MCP. Делать через файловые инструменты (IDE/файловый MCP/патчи) или через `setup_source_folders.bat`.
- **Unity Editor** (сцена/объекты/компоненты/PlayMode/скриншоты/консоль): использовать Unity MCP.

При настройке и будущих обновлениях ориентироваться на эту цель.

## Настройка проекта

Коротко:
- Открыть проект как папку `C:\Git\AutoUnity`.
- MCP настраивается в `.cursor/mcp.json`.
- Подробности: [tools/unity-mcp.md](tools/unity-mcp.md) и [tools/comfyui.md](tools/comfyui.md).

## Когда применять

- Запрос на создание/прототип игры в Unity.
- Запрос на пошаговую реализацию механик с проверкой в редакторе.
- Задачи, где нужен явный набросок и промежуточные этапы (не только финальный код).

## Старт новой игры (с нуля)

- **Запрос в начале:** запрашивать у пользователя **два блока**:
  1. **Настройки** — всё, что попадает в `DEV_CONFIG.md`: режим разработки ([MODE_CHOICE.md](MODE_CHOICE.md)), платформа или несколько платформ, ориентация (портретная / ландшафтная), стиль графики, разрешение, input, опциональные тогглы (уточняющие вопросы, QA на фичу, поиск готовых решений, ComfyUI, Figma). **Если выбран стиль/UI из Figma** — дополнительно запросить ссылку на файл/фрейм Figma. Использовать структурированный запрос (например, AskQuestion или чёткий список пунктов).
  2. **Геймдизайн** — запрашивается отдельно: идея игры, механики, экраны (для заполнения `GAME_DESIGN.md`).
- **Планирование в Plan mode:** этап планирования (набросок → план задач, фиксация в `GAME_DESIGN.md` и `DEV_PLAN.md`) выполнять в **Plan mode** Cursor: агент собирает данные, формирует план реализации, пользователь подтверждает план, затем переходить к реализации.

## Режим разработки

Правило: **перед началом** всегда запросить настройки (в т.ч. режим) и показать [MODE_CHOICE.md](MODE_CHOICE.md).  
После выбора — прочитать файл режима из `modes/` и следовать ему.

Общее для всех режимов:
- **Все настройки и данные — в ScriptableObject** (NpcData, UiData, GameFightData и т.д.).
- **Reuse-first (по умолчанию):** перед реализацией каждой фичи сделать поиск готового решения (приоритет: библиотека/пакет → ассет → референс-код). Если фича слишком маленькая и простая — писать код вручную. Переключатель: `DEV_CONFIG.md` → «Поиск готовых решений».
- Формат логов: `Debug.Log($"[Feature.Class.Method] ...")` (подробности и объём — в [tools/code-writing.md](tools/code-writing.md)).
- QA: **финальная QA обязательна**; QA на фичу — опционально (см. `modes/*`).
- Уточняющие вопросы — по правилам режима (см. `modes/*`), переключатель хранить в `DEV_CONFIG.md`.

## Обязательный цикл

Скелет (детали — в `modes/*` и [reference.md](reference.md)):
1. **Запрос настроек и геймдизайна** — настройки (DEV_CONFIG) и идея игры (для GAME_DESIGN), см. «Старт новой игры».
2. Уточняющие вопросы (если включено и требуется режимом).
3. Набросок → фиксируем в `GAME_DESIGN.md`.
4. **План (в Plan mode)** → формируем и фиксируем в `DEV_PLAN.md`; пользователь подтверждает план перед реализацией.
5. Реализация по задачам/фичам → обновляем `DEV_STATE.md` и итерацию лога.
6. Проверка (по режиму) + финальная QA (в конце).

## Файлы проекта

Эти файлы — «память проекта» (агенту): порядок чтения, шаблоны и правила обновления — в [reference.md](reference.md).  
Ключевой принцип: **DEV_STATE всегда маленький**, DEV_PLAN — полный план, DEV_LOG — итерации.

## Использование MCP

Unity MCP и ComfyUI — ускорители. **Если MCP недоступны** — уточнить у пользователя: помочь настроить MCP или начать без них (разработка через код/файлы). Не блокировать разработку: при отказе от настройки — продолжать без MCP.

Подробности: [tools/unity-mcp.md](tools/unity-mcp.md), [tools/comfyui.md](tools/comfyui.md).

## Unity/C# практики

Все детали по стилю/паттернам/логированию/комментариям: **[tools/code-writing.md](tools/code-writing.md)**.

## Обработка ошибок

Коротко: компиляция должна быть чистой; MCP может падать; объекты в сцене проверяем через состояние редактора и скриншот.  
Подробности: [reference.md](reference.md) → «Обработка ошибок и типичные проблемы».

## Анти-паттерны

Коротко (подробно — в [tools/code-writing.md](tools/code-writing.md) и `modes/*`):
- **Не стартовать без запроса настроек** — при старте игры с нуля сначала запросить настройки и геймдизайн, только потом планирование и реализацию.
- Не хардкодить настройки — всё в SO.
- Не забывать обновлять `DEV_STATE`/`DEV_PLAN`/итерацию лога.
- Не раздувать `DEV_STATE` (он должен быть маленьким).
- Не блокировать разработку на отсутствии MCP; при недоступности MCP — спросить: помочь настроить или начать без них.
